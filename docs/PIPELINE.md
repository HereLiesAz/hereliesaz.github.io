# Asset Pipeline

The asset pipeline is a collection of Python scripts located in the `scripts/` directory. These scripts transform raw image files into the data formats required by the frontend.

## 1. The Grinder (`scripts/grinder.py`)
*The "pointillist" generator.*

**Purpose**: breaks an image down into atomic "strokes".

**Process**:
1.  **Input**: Reads an image from `assets/raw`.
2.  **Depth Estimation**: Uses **MiDaS** (Monocular Depth Estimation) to create a depth map. This allows strokes to be placed at different Z-depths relative to the canvas plane, giving the 2D image 3D volume.
3.  **Segmentation**: Uses **SAM (Segment Anything Model)** to identify coherent regions (objects, shapes, brushstrokes) in the image.
4.  **Stroke Generation**: For each segment (mask):
    - Calculates the bounding box.
    - Calculates the average color.
    - Calculates the average depth (Z).
    - Assigns a "stability" score (used for visual effects).
5.  **Output**: Saves a JSON file to `public/data/{filename}.json` containing the array of strokes.

## 2. Pareidolia (`scripts/pareidolia.py`)
*The "ghost" finder.*

**Purpose**: Detects face-like patterns in the abstract imagery to add subliminal "watchers" in the void.

**Process**:
1.  **Algorithm**: Uses an **OpenCV Haar Cascade** (specifically `haarcascade_frontalface_alt2.xml`).
    - *Note*: We intentionally use an older, less accurate model because it is more prone to **pareidolia** (seeing faces in random noise/patterns), which is the desired artistic effect.
2.  **Injection**: It reads the JSON files generated by the Grinder and appends a `pareidolia` array containing the UV coordinates of detected "faces".

## 3. The Indexer (`scripts/indexer.py`)
*The Librarian.*

**Purpose**: Aggregates all processed data into a single master file for the frontend.

**Process**:
1.  **Metadata Merging**: Reads processed JSONs and looks for corresponding Markdown files in `assets/meta/` (Prose.io compatible frontmatter) to get titles, years, descriptions, etc.
2.  **Graph Building**:
    - Calculates the "Dominant Color" of each artwork.
    - Builds a **Nearest Neighbor Graph** based on color distance. This allows the frontend to recommend "visually similar" artworks when the user finishes viewing one.
3.  **Output**: Generates `public/manifest.json`.
